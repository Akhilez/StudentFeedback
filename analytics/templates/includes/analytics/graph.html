<div>

    Graph number: {{ graph.s_no }}<br/>

    <form action="" method="post">
        {% csrf_token %}
        <div class="btn-group">
            {% for typ in graph.types %}
                <input type="submit" class="btn btn-primary" name="{{ typ }}" value="{{ typ }}">
            {% endfor %}
        </div>
    </form>

    <div id="graph"></div>

    <script language="JavaScript">

        var prev_title = [];

        var chrt = Highcharts.chart('graph', {
            chart: {
                {% ifequal graph.type 'null' %}
                    type: 'column',
                {% else %}
                    type: '{{ graph.type }}',
                {% endifequal %}
                renderTo: 'container',
                width: {{ graph.width }},
                height: {{ graph.height }},
                events: {
                    drilldown: function(e) {
                        {% if graph.type == 'bar' %}
                            var len = e.seriesOptions.data.length;
                            var height_per_bar = {{ graph.height_per_bar }};
                            var height = len * height_per_bar * 1.5;
                            this.setSize(this.width, height);
                        {% endif %}
                        chrt.setTitle({ text: e.point.series.name + ' ' + e.point.name });
                        prev_title.push(e.point.series.name)
                    },
                    drillup: function(e) {
                        {% if graph.type == 'bar' %}
                            var len = e.seriesOptions.data.length;
                            var height_per_bar = {{ graph.height_per_bar }};
                            var height = len * height_per_bar * 1.5;
                            this.setSize(this.width, height);
                        {% endif %}
                        chrt.setTitle({ text: prev_title.pop() });
                    }
                }
            },
            credits: {
                enabled: false
            },
            title: {text: '{{ graph.title }}'},
            subtitle: {text: '{{ graph.subtitle }}'},
            xAxis: {type: 'category'},
            yAxis: {
                title: {text: 'Performance'}
            },
            legend: {enabled: false},
            plotOptions: {
                series: {
                    borderWidth: 0,
                    dataLabels: {
                        enabled: true,
                        format: '{point.y:.1f}'
                    }
                }
            },
            tooltip: {
                headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
                pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}</b> of 5<br/>'
            },
            series: [
                {
                    name: '{{ graph.series.name }}',
                    colorByPoint: true,
                    data: [
                        {% for bar in graph.series.bars %}
                            {
                                name: '{{ bar.name }}',
                                y: {{bar.value}},
                                {% ifequal bar.drilldown 'null' %}
                                    drilldown: null
                                {% else %}
                                    drilldown: '{{ bar.drilldown }}'
                                {% endifequal %}
                            },
                        {% endfor %}
                    ]
                }
            ],
            drilldown: {
                series: [
                    {% for series in Drilldown %}
                        {
                            name: '{{ series.name }}',
                            id: '{{ series.id }}',
                            colorByPoint: true,
                            data: [
                                {% for bar in series.bars %}
                                    {
                                        name: '{{ bar.name }}',
                                        y: {{ bar.value }},
                                        {% ifequal bar.drilldown 'null' %}
                                            drilldown: null
                                        {% else %}
                                            drilldown: '{{ bar.drilldown }}'
                                        {% endifequal %}
                                    },
                                {% endfor %}
                            ]
                        },
                    {% endfor %}
                ]
            }
        });

    </script>

</div>

